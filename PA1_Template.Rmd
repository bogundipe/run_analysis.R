---
title: "Reproductible Research"
author: "Bolaji Ogundipe"
date: "8/4/2019"
output:
  html_document: default
  pdf_document: default
---

### getting data from the web

```{r, echo=FALSE}
if (!file.exists("./actmdata.csv")) {
  dir.create("./actmdata.csv")
}
fileurl <-
  "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
download.file(fileurl, destfile = "activity.zip", method = "curl")
unzip("./activity.zip")
library(dplyr)
dt <- read.csv("activity.csv")
```

### cleaning data

```{r, echo=FALSE}
dt$date <- as.Date(dt$date)
dt$interval <- as.factor(dt$interval)
str(dt)
```

### calculating mean of steps by day

```{r, echo=FALSE}
library(plyr)
step_day <-
  ddply(dt, .(date), summarise, sum = sum(steps, na.rm = TRUE))
hist(
  step_day$sum,
  ylab = "# of days",
  xlab = "# of Steps",
  col = "magenta",
  main = "Average Step per day (Oct-Nov 2012)"
)
```

### calculatong mean & median of steps taken per day

```{r, echo=FALSE}
mean(step_day$sum)
median(step_day$sum)
```

### calculating & plotting average daily activity pattern

```{r, echo=FALSE}
step_interval_daily <-
  ddply(dt, .(interval), summarise, sum = sum(steps, na.rm = TRUE))

library(ggplot2)
fig <-
  ggplot(step_interval_daily, aes(x = interval, y = sum, group = "1"))
fig + geom_line() + labs(title = "Average steps per day @ 5 mins interval (Oct-Nov 2012)") + labs(x = "5 mins interval", y = "Avg # of steps")
```

### calculating max daily step

```{r, echo=FALSE}
step_interval_daily [which(step_interval_daily$sum == max(sum(step_interval_daily$sum))),]
```

### inputting missing values

```{r, echo=FALSE}
missing_values <- dt[!complete.cases(dt),]
nrow(missing_values)

interval_mean <-
  ddply(dt, .(interval), summarise, mean = mean(steps, na.rm = TRUE))

new_dt <- join(dt, interval_mean)

replace_NA <- function(dataset, variable, replacement) {
  for (i in 1:nrow(dataset)) {
    if (is.na(dataset[i, variable])) {
      dataset[i, variable] <- dataset[i, replacement]
    }
  }
  dataset
}

complete_dt <- replace_NA(new_dt, variable = 1, replacement = 4)

complete_dt <- complete_dt[,-4]
head(complete_dt)
```

### making histogram for all steps taken

```{r, echo=FALSE}
all_steps_per_day <-
  ddply(complete_dt, .(date), summarise, sum = sum(steps))
all_steps_per_day$sum <- round(all_steps_per_day$sum)
hist(
  all_steps_per_day$sum,
  ylab = "# of Days",
  col = "green",
  xlab = "# of Steps",
  main = "Histogram of Steps Per Day (Oct-Nov 2012)"
)
```

### comparing mean & median

```{r, echo=FALSE}
mean(step_day$sum)
mean(all_steps_per_day$sum)

median(step_day$sum)
median(all_steps_per_day$sum)
```

### making seperate hist to show the impact of replacing missing value

```{r, echo=FALSE}
par(mfrow=c(1,2)) 
hist(step_day$sum, ylab="# of Days", col=rgb(1,0,0,0.5), xlab="# of Steps", main="Steps Per Day w/o NA")
hist(all_steps_per_day$sum, ylab="# of Days", col=rgb(0,0,1,0.5), xlab="# of Steps", main="Steps Per Day replacing NA")
```

### making stacked hist to show impact of replacing NA

```{r, echo=FALSE}
hist(step_day$sum,ylim=c(0,25),breaks=10,col=rgb(1,0,0,0.5), ylab="# of Days", xlab="# of Steps", main="Steps Per Day (NA vs replace)")
par(new=TRUE)
hist(all_steps_per_day$sum,ylim=c(0,25),breaks=10,col=rgb(0,0,1,0.5),main="",xlab="",ylab="")
legend('topleft',c('NA','replaced'),
       fill = c(rgb(1,0,0,0.5), rgb(0,0,1,0.5)), bty = 'n',
       border = NA)
```

### showing differnce in steps of weekdays & weekends

```{r, echo=FALSE}
install.packages("timeDate", repos = "http://cran.us.r-project.org")
library(timeDate)
complete_dt$day_of_week <- ifelse(isWeekday(all_steps_per_day$date)==TRUE, "weekday", "weekend")

library(lattice)
xyplot(steps ~ interval | day_of_week, layout = c(1, 2), data=complete_dt, type="l")
```
